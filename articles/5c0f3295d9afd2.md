---
title: "ã€Rustã€‘Google Indexing APIã®URLã‚’ä¸€æ‹¬ã§é€ä¿¡"
emoji: "ğŸ¦€"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [ "Rust","GoogleIndexingAPI","GoogleForJobs","GoogleãŠä»•äº‹æ¤œç´¢" ]
published: false
---

## ã¯ã˜ã‚ã«

æ±‚äººã‚µã‚¤ãƒˆã§ã¯å¿…é ˆã¨ã„ã£ã¦è‰¯ã„GoogleãŠä»•äº‹æ¤œç´¢ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ç™»éŒ²ã‚’ä¸€æ‹¬ã§è¡Œãˆã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚
Rustã§ä½¿ãˆã‚‹[google-indexing-api](https://crates.io/crates/google-indexing-api)ã®ä½¿ã„æ–¹ã‚’ç´¹ä»‹ã—ã¦ã„ãã¾ã™ã€‚

## GoogleIndexAPIã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```toml
[dependencies]
google-indexing-api = "0.1"  
```

## å®Ÿè£…

### URLã‚’ä¸€æ‹¬ã§æ›´æ–°ã™ã‚‹æ–¹æ³•

```rust
async fn update_url(token: &str) {
    let response = GoogleIndexingApi::url_notifications().batch(
        token,
        vec![
            "http://example.com/widgets/1".to_string(),
            "http://example.com/widgets/2".to_string(),
        ],
        UrlNotificationsType::UPDATED
    ).await;
    if let Ok(batch_list) = response {
        for batch in batch_list {
            println!("{} {:?}", batch.url(), batch.json());
        }
    }
}
```

### URLã‚’ä¸€æ‹¬ã§å‰Šé™¤ã™ã‚‹æ–¹æ³•

```rust
async fn delete_url(token: &str) {
    let response = GoogleIndexingApi::url_notifications().batch(
        token,
        vec![
            "http://example.com/widgets/1".to_string(),
            "http://example.com/widgets/2".to_string(),
        ],
        UrlNotificationsType::DELETE
    ).await;
    if let Ok(batch_list) = response {
        for batch in batch_list {
            println!("{} {:?}", batch.url(), batch.json());
        }
    }
}
```

## è§£èª¬ãƒ»è£œè¶³

GoogleIndexingAPIã‚’ä½¿ã†ãŸã‚ã«ã¯ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ç”¨æ„ã— `https://www.googleapis.com/auth/indexing` ã®æ¨©é™ã‚’ä»˜ä¸ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
ã‚µãƒ³ãƒ—ãƒ«ã§ã¯ yup_oauth2 ã‚’ä½¿ã£ã¦ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã—ã¦ã„ã¾ã™ãŒã€åˆ¥ã®æ–¹æ³•ã§ã‚‚æ§‹ã„ã¾ã›ã‚“ã€‚

```rust
async fn test_token() -> AccessToken {
    // èªè¨¼
    let secret = yup_oauth2::read_service_account_key("./test.json")
        .await
        .expect("test.json");
    let auth = yup_oauth2::ServiceAccountAuthenticator::builder(secret).build().await.unwrap();
    let scopes = &["https://www.googleapis.com/auth/indexing"];

    let token = auth.token(scopes).await;
    token.unwrap()
}
```

ã¾ãŸã€IndexingAPIã¯ä¸€æ—¥ã«200ä»¶ã¾ã§ã—ã‹é€ä¿¡ã§ããªã„ãŸã‚ã€é€ä¿¡ã™ã‚‹URLãŒå¤šã„å ´åˆã¯ä¸Šé™ã®å‰²å½“ã‚’ç·©å’Œã™ã‚‹å¿…è¦ãŒæœ‰ã‚Šã¾ã™ã€‚
https://developers.google.com/search/apis/indexing-api/v3/quota-pricing?hl=ja#request-more-quota

GoogleAPI Consoleã‹ã‚‰ä¸Šé™ã®ç·©å’Œã‚’ã™ã‚Œã°å‰²ã¨ã™ãã«ç·©å’Œã—ã¦ãã‚Œã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/222603de2260-20230914.png)
ç§ãŒç”³è«‹ã™ã‚‹ã¨ãã«ã¯ã‚µã‚¤ãƒˆã«ã‚ã‚‹æ±‚äººæ•°ã¨ä¸€æ—¥ã®æ›´æ–°è¦‹è¾¼ã¿ã‚’è¨˜è¼‰ã™ã‚‹ã¨ã“ã¨ã§é€šã‚Šã¾ã—ãŸã€‚